# Промежуточный образ: базовый образ + зависимости.
# Сборка: docker build -t llm-gate-mcp-deps -f Dockerfile.mcp.deps .
# Пересобирать только при изменении pyproject.toml.
FROM python:slim
WORKDIR /app
RUN apt-get update && apt-get install -y --no-install-recommends curl \
    && rm -rf /var/lib/apt/lists/*
COPY pyproject.toml ./
# Пустая src/app нужна для editable install
RUN --mount=type=cache,target=/root/.cache/pip \
    mkdir -p src/app && touch src/app/__init__.py \
    && pip install -e ".[mcp]" \
        --index-url https://download.pytorch.org/whl/cpu \
        --extra-index-url https://pypi.org/simple/
